{% extends "base.html" %}
{% block title %}New Proposal - Jeremy's CRM{% endblock %}
{% block content %}
<h1>New Proposal</h1>
<form method="post" action="{{ url_for('add_proposal') }}" class="entity-form">
    <div class="form-group">
        <label for="name">Proposal Name *</label>
        <input type="text" id="name" name="name" placeholder="Proposal name" required>
    </div>
    <div class="form-group">
        <label for="follow_up_id">Linked Opportunity</label>
        <input type="text" class="filter-input" placeholder="Search opportunities..." onkeyup="filterSelect(this, 'follow_up_id')">
        <select id="follow_up_id" name="follow_up_id">
            <option value="">-- None --</option>
            {% for fu in follow_ups %}
            <option value="{{ fu.id }}">{{ fu.title }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label>Onboarding Fee ($)</label>
        <div class="fee-range-row">
            <div class="fee-range-field">
                <span class="fee-label">Min</span>
                <input type="number" id="onboarding_fee" name="onboarding_fee" step="0.01" min="0" placeholder="0.00">
            </div>
            <div class="fee-range-field">
                <span class="fee-label">Max</span>
                <input type="number" id="onboarding_fee_max" name="onboarding_fee_max" step="0.01" min="0" placeholder="0.00">
            </div>
        </div>
    </div>
    <div class="form-group">
        <label>Monthly Retainer ($)</label>
        <div class="fee-range-row">
            <div class="fee-range-field">
                <span class="fee-label">Min</span>
                <input type="number" id="monthly_retainer" name="monthly_retainer" step="0.01" min="0" placeholder="0.00">
            </div>
            <div class="fee-range-field">
                <span class="fee-label">Max</span>
                <input type="number" id="monthly_retainer_max" name="monthly_retainer_max" step="0.01" min="0" placeholder="0.00">
            </div>
        </div>
    </div>
    <div class="form-group">
        <label for="status">Status</label>
        <select id="status" name="status">
            <option value="Draft" selected>Draft</option>
            <option value="Sent">Sent</option>
            <option value="Negotiating">Negotiating</option>
            <option value="Won">Won</option>
            <option value="Lost">Lost</option>
        </select>
    </div>
    <div class="form-group">
        <label>Contact Individuals</label>
        <input type="text" class="filter-input" placeholder="Search contacts..." onkeyup="filterList(this, 'contact-individuals-list')">
        <div class="checkbox-list" id="contact-individuals-list">
            {% for ind in individuals %}
            <label class="checkbox-item">
                <input type="checkbox" name="contact_individuals" value="{{ ind.id }}"> {{ ind.name }}
            </label>
            {% endfor %}
        </div>
    </div>
    <div class="form-group">
        <label for="date_sent">Date Sent</label>
        <input type="date" id="date_sent" name="date_sent">
    </div>
    <div class="form-group">
        <label for="follow_up_date">Follow-up Date</label>
        <input type="date" id="follow_up_date" name="follow_up_date">
    </div>
    <div class="form-group">
        <label for="scope_of_work">Scope of Work</label>
        <textarea id="scope_of_work" name="scope_of_work" placeholder="Describe the scope..."></textarea>
    </div>
    <div class="form-group">
        <label for="timeline">Timeline</label>
        <input type="text" id="timeline" name="timeline" placeholder="e.g., 4 weeks">
    </div>
    <div class="form-group">
        <label for="notes">Notes</label>
        <textarea id="notes" name="notes" placeholder="General notes..."></textarea>
    </div>
    <div class="form-actions">
        <button type="submit" class="btn">Create Proposal</button>
        <a href="{{ url_for('proposals') }}" class="btn btn-secondary">Cancel</a>
    </div>
</form>
<script>
function filterSelect(input, selectId) {
    var filter = input.value.toLowerCase();
    var select = document.getElementById(selectId);
    var options = select.querySelectorAll('option');
    options.forEach(function(opt) {
        if (!opt.value) return;
        opt.style.display = opt.textContent.toLowerCase().includes(filter) ? '' : 'none';
    });
}
function filterList(input, listId) {
    const filter = input.value.toLowerCase();
    const items = document.getElementById(listId).querySelectorAll('.checkbox-item');
    items.forEach(function(item) {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(filter) ? '' : 'none';
    });
}
</script>
{% endblock %}
