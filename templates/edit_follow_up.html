{% extends "base.html" %}
{% block title %}Edit Opportunity - Jeremy's CRM{% endblock %}
{% block content %}
<h1>Edit Opportunity</h1>
<form method="post" class="entity-form">
    <div class="form-group">
        <label for="title">Name *</label>
        <input type="text" id="title" name="title" value="{{ follow_up.title }}" required>
    </div>
    <div class="form-group">
        <label for="opp_type">Type</label>
        <select id="opp_type" name="opp_type">
            <option value="Position" {% if follow_up.opp_type == 'Position' %}selected{% endif %}>Position</option>
            <option value="Consulting" {% if follow_up.opp_type == 'Consulting' %}selected{% endif %}>Consulting</option>
            <option value="TBD" {% if follow_up.opp_type == 'TBD' or not follow_up.opp_type %}selected{% endif %}>TBD</option>
        </select>
    </div>
    <div class="form-group">
        <label for="body">Notes</label>
        <textarea id="body" name="body">{{ follow_up.body or '' }}</textarea>
    </div>
    <div class="form-group">
        <label>Link Companies</label>
        <input type="text" class="filter-input" placeholder="Search companies..." onkeyup="filterList(this, 'edit-companies')">
        <div class="checkbox-list" id="edit-companies">
            {% for c in all_companies %}
            <label class="checkbox-item">
                <input type="checkbox" name="link_companies" value="{{ c.id }}"
                       {% if c.id in linked_company_ids %}checked{% endif %}> {{ c.name }}
            </label>
            {% endfor %}
        </div>
    </div>
    <div class="form-group">
        <label>Link Individuals</label>
        <input type="text" class="filter-input" placeholder="Search individuals..." onkeyup="filterList(this, 'edit-individuals')">
        <div class="checkbox-list" id="edit-individuals">
            {% for i in all_individuals %}
            <label class="checkbox-item">
                <input type="checkbox" name="link_individuals" value="{{ i.id }}"
                       {% if i.id in linked_individual_ids %}checked{% endif %}> {{ i.name }}
            </label>
            {% endfor %}
        </div>
    </div>
    <div class="form-actions">
        <button type="submit" class="btn">Save Changes</button>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancel</a>
    </div>
</form>
<script>
function filterList(input, listId) {
    const filter = input.value.toLowerCase();
    const items = document.getElementById(listId).querySelectorAll('.checkbox-item');
    items.forEach(function(item) {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(filter) ? '' : 'none';
    });
}
</script>
{% endblock %}
